(()=>{"use strict";const e=e=>{const t=document.getElementById("tbody");t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n            <tr class="table__row" data-key="${e.id}">\n                <td class="table__id table__cell table__id">${e.id}</td>\n                <td class="table-type table__cell table__type">${e.type}</td>\n                <td class="table-name table__cell table__name">${e.name}</td>\n                <td class="table-units table__cell table__units">${e.units}</td>\n                <td class="table-cost table__cell table__cost">${e.cost}</td>\n                <td>\n                    <div class="table__actions table__cell">\n                        <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change"><use xlink:href="./img/sprite.svg#change"></use></svg></span><span>Изменить</span>\n                        </button>\n                        <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove"><use xlink:href="./img/sprite.svg#remove"></use></svg></span><span>Удалить</span>\n                        </button>\n                    </div>\n                </td>\n            </tr> `)}))},t=(e,t)=>{e.addEventListener("input",(()=>{e.value=e.value.replace(t,"")}))};window.itemService=new class{getItems(){return fetch("http://localhost:4545/items").then((e=>e.json()))}addItems(e){return fetch("http://localhost:4545/items",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}removeItems(e){return fetch(`http://localhost:4545/items/${e}`,{method:"DELETE"}).then((e=>e.json()))}editItem(e,t){return fetch(`http://localhost:4545/items/${e}`,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}getItem(e){return fetch(`http://localhost:4545/items/${e}`).then((e=>e.json()))}filterItems(e){return fetch(`http://localhost:4545/items/?type=${e}`).then((e=>e.json()))}sortItems(e){return fetch(`http://localhost:4545/items/?_sort=${e.name}&_order=${e.value}`).then((e=>e.json()))}searchItems(e){return fetch(`http://localhost:4545/items/?q=${e}`).then((e=>e.json()))}},itemService.getItems().then((t=>{e(t)})),(()=>{const e=document.getElementById("typeItem");let t,s=[];itemService.getItems().then((n=>{for(let e=0;e<n.length;e++){let t=!1;if(s.length>0)for(let o=0;o<s.length;o++)if(n[e].type===s[o].type){t=!0;break}!1===t&&s.push(n[e])}s.forEach(((s,n)=>{t=document.createElement("option"),t.textContent=s.type,e.options[n].after(t)}))})).catch((e=>console.log(e.message)))})(),(()=>{const t=document.getElementById("typeItem");t.addEventListener("change",(()=>{itemService.getItems().then((s=>{t.options[0]&&e(s),s.forEach((s=>{t.options[t.selectedIndex].textContent===s.type&&itemService.filterItems(s.type).then((t=>{e(t)}))}))})).catch((e=>console.log(e.message)))}))})(),(()=>{const s=document.querySelector(".btn-addItem"),n=document.getElementById("modal"),o=n.querySelector(".modal__header"),l=document.querySelector("form"),a=l.querySelectorAll(".input"),c=l.querySelector("#type1"),r=l.querySelector("#name"),i=l.querySelector("#units"),m=l.querySelector("#cost"),d=l.querySelector(".errorText");s.addEventListener("click",(()=>{n.style.display="flex",o.textContent="Добавление новой услуги",l.removeAttribute("data-item")})),n.addEventListener("click",(e=>{(e.target.closest(".button__close")||e.target.closest(".cancel-button")||!e.target.closest(".modal"))&&(e.preventDefault(),l.reset(),n.style.display="",d.style.opacity="")})),t(m,/\D/g),l.addEventListener("submit",(t=>{t.preventDefault();let s=!1;if(a.forEach((e=>{if(""===e.value)return d.style.opacity=1,void(s=!0)})),!l.dataset.item&&!0!==s){d.style.opacity="";const t={type:c.value.trim(),name:r.value.trim(),units:i.value.trim(),cost:+m.value};itemService.addItems(t).then((()=>{itemService.getItems().then((t=>{e(t),l.reset(),setTimeout((()=>{n.style.display=""}),700)})).catch((e=>{console.log(e.message)}))}))}}))})(),(()=>{const s=document.getElementById("tbody"),n=document.getElementById("modal"),o=n.querySelector(".modal__header"),l=document.querySelector("form"),a=l.querySelectorAll(".input"),c=l.querySelector("#type1"),r=l.querySelector("#name"),i=l.querySelector("#units"),m=l.querySelector("#cost"),d=l.querySelector(".errorText");t(m,/\D/g),s.addEventListener("click",(e=>{if(e.target.closest(".action-change")){n.style.display="flex",o.textContent="Редактировать услугу";const t=e.target.closest("tr").dataset.key;itemService.getItem(t).then((e=>{c.value=e.type,r.value=e.name,i.value=e.units,m.value=e.cost})),l.dataset.item=t}})),l.addEventListener("submit",(t=>{t.preventDefault();let s=!1;if(a.forEach((e=>{if(""===e.value)return d.style.opacity=1,void(s=!0)})),l.dataset.item&&!0!==s){const t=l.dataset.item,s={type:c.value.trim(),name:r.value.trim(),units:i.value.trim(),cost:+m.value};itemService.editItem(t,s).then((()=>{itemService.getItems().then((t=>{e(t),l.reset(),l.removeAttribute("data-item"),setTimeout((()=>{n.style.display=""}),700)})).catch((e=>{console.log(e.message)}))}))}}))})(),document.getElementById("tbody").addEventListener("click",(t=>{if(t.target.closest(".action-remove")){const s=t.target.closest("tr").dataset.key;itemService.removeItems(s).then((t=>{itemService.getItems().then((t=>{e(t)})).catch((e=>console.log(e.message)))})).catch((e=>console.log(e.message)))}})),(()=>{const t=document.querySelectorAll(".table-th");let s=!1;const n=t=>{itemService.sortItems({name:t,value:s?"asc":"desc"}).then((t=>{e(t)})).catch((e=>console.log(e.message)))};t.forEach((e=>{e.addEventListener("click",(t=>{e.closest(".th-id")&&(n("id"),s=!s),e.closest(".th-type")&&(n("type"),s=!s),e.closest(".th-name")&&(n("name"),s=!s),e.closest(".th-units")&&(n("units"),s=!s),e.querySelector(".icon-sort").classList.toggle("rotate")}))}))})(),(()=>{const t=document.getElementById("search-input"),s=((e,t=300)=>{let s;return(...n)=>{clearTimeout(s),s=setTimeout((()=>{e.apply(void 0,n)}),t)}})((()=>{itemService.searchItems(t.value.trim()).then((t=>{e(t)})).catch((e=>console.log(e.message)))}),800);t.addEventListener("input",s)})()})();